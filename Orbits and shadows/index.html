<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Im causing problems on purpose</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	</head>
	<body>
		<script type="module">

			import * as THREE from './files/three.js';
			import { OrbitControls } from './files/OrbitControls.js';
			import { PointLight } from './src/lights/PointLight.js';
			import { AmbientLight } from './src/lights/AmbientLight.js';

			let camera, scene, renderer;
			let mesh;
			let mesh2;
			let mesh3;
			let t=0;

		

			function init() {

				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.1, 100 );
				camera.position.z = 2;

				
				scene = new THREE.Scene();

				renderer = new THREE.WebGLRenderer({ antialias: true });
				renderer.shadowMap.enabled = true;
				renderer.shadowMap.type = THREE.PCFSoftShadowMap;
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.setAnimationLoop( animate );
				
				document.body.appendChild( renderer.domElement );
			
				const light = new THREE.PointLight(0xFFFFFF,2000);
				light.position.set( 40, 0, 0 );
				light.castShadow = true;
				scene.add(light);
				//const helper = new THREE.CameraHelper( light.shadow.camera );
				//scene.add( helper );
				const background_lighting = new THREE.AmbientLight(0x44aaaa,0.5);
				scene.add(background_lighting);

				const planet = new THREE.SphereGeometry( 20, 50, 50 );
				const planet_material_1 = new THREE.MeshPhongMaterial({color:0x550055});

				const moon_1 = new THREE.SphereGeometry(3, 50, 50 ); 
				const moon_material_1 = new THREE.MeshPhongMaterial( { color: 0x005500 } );

				const moon_2 = new THREE.SphereGeometry(2,25,25);
				const moon_material_2 = new THREE.MeshPhongMaterial({color: 0x550000})

				mesh = new THREE.Mesh( planet, planet_material_1 );
				mesh.position.set(0,0,0);
				mesh.castShadow = true;
				mesh.recieveShadow = true;
			    scene.add(mesh);
				mesh2 = new THREE.Mesh(moon_1,moon_material_1);
				mesh2.castShadow = true;
				mesh2.recieveShadow = true;
				scene.add(mesh2);
				mesh3 = new THREE.Mesh(moon_2,moon_material_2);
				mesh3.castShadow = true;
				mesh3.recieveShadow = true;
				scene.add(mesh3);

				scene.traverse( function( child ) 
				{ 

					if ( child.isMesh ) {

						child.castShadow = true;
						child.receiveShadow = true;

					}
				} );

				const controls = new OrbitControls( camera, renderer.domElement );
				camera.position.set( 0, 20, 60 );
				controls.update();

				window.addEventListener( 'resize', onWindowResize );
			}

			init();

			function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );
			}

			let angle = 0;
			const radius = 23;
			const speed = 0.0001;
			function animate() {
				requestAnimationFrame(animate);

				angle += speed;
				mesh.recieveShadow = true;
				mesh3.castShadow = true;
				mesh2.position.x = radius * Math.cos(angle);
				mesh2.position.z = radius * Math.sin(angle);
				mesh2.position.y = radius * Math.cos(angle);
				mesh3.position.x = (radius+4) * (Math.cos(angle/2));
				mesh3.position.z = (radius+4) * (Math.sin(angle/2));

				renderer.render( scene, camera );
			}
			

		</script>

	</body>
</html>
